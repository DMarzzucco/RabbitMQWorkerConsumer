@startuml PagoFlow

start

:Cliente realiza un pedido;
:Pedido enviado al Servicio de Pagos;

if (¿El usuario tiene fondos suficientes?) then (No)
    :Error 402 - No tienes fondos suficientes;
    stop
else (Sí)
    if (¿La tarjeta es válida?) then (No)
        :Error 400 - Tarjeta inválida;
        stop
    else (Sí)
        :Procesar pago;
        :Confirmación de pago exitosa;

        -> Servicio de Pagos publica en Exchange de RabbitMQ;
        -> Mensaje enviado a la Cola de confirmaciones de pago;

        :Servicio de Pedidos recibe el mensaje;
        :Actualiza estado del pedido a "Confirmado";

        :Notifica al API Gateway;
        -> Cliente ve el estado actualizado;

        stop
    endif
endif

@enduml

